import{Q as l,R as f,S as p,j as d,J as y,I as c,U as h}from"./BdPuCSAw.js";import{a as v,u as m}from"./iFRJtkhy.js";const w="$s";function k(...t){const o=typeof t[t.length-1]=="string"?t.pop():void 0;typeof t[0]!="string"&&t.unshift(o);const[e,n]=t;if(!e||typeof e!="string")throw new TypeError("[nuxt] [useState] key must be a string: "+e);if(n!==void 0&&typeof n!="function")throw new Error("[nuxt] [useState] init must be a function: "+n);const a=w+e,i=l(),s=f(i.payload.state,a);if(s.value===void 0&&n){const u=n();if(p(u))return i.payload.state[a]=u,u;s.value=u}return s}const x=()=>{const t=v("auth_token"),o=k("user",()=>null),e=async(i,s)=>{const r=await m().post("/auth/login",{phone:i,password:s});if(r.success)return t.value=r.accessToken,o.value=r.user,r;throw new Error("Login failed")},n=()=>{t.value=null,o.value=null,c("/")},a=d(()=>!!t.value);return{user:y(o),login:e,logout:n,isAuthenticated:a}},S=h((t,o)=>{const{isAuthenticated:e}=x();if(!e.value&&t.path.startsWith("/panel"))return c("/login")});export{S as default};
